<div class="line-creator">
  <gmp-map-3d
    *ngIf="apiReady"
    #map3dRef
    class="line-creator__map"
  ></gmp-map-3d>
  <p *ngIf="mapUnavailable" class="line-creator__map-unavailable">3D map is unavailable right now.</p>
</div>
<div class="width-container-flex">
  <div class="line-creator__actions">
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
      <div class="form-group landing-page__form-element">
        <input
          type="text"
          class="input"
          id="inputName"
          formControlName="lineName"
          [ngClass]="registerForm?.get('lineName').value?.length !== 0 ? 'input--active' : ''"
          required
        />
        <label for="inputName">Enter name of the line</label>
      </div>
      <div class="form-group landing-page__form-element">
        <select
          [formControl]="registerForm.controls.lineSport"
          class="input"
          [ngClass]="registerForm.get('lineSport').value?.length !== 0 ? 'input--active' : ''"
          id="sport-select"
        >
          <option *ngFor="let type of sportsTypes" [ngValue]="type">{{ type }}</option>
        </select>
        <label for="sport-select">Sport</label>
      </div>
      <div class="form-group landing-page__form-element">
        <select
          [formControl]="registerForm.controls.lineType"
          class="input"
          [ngClass]="registerForm?.get('lineType').value?.length !== 0 ? 'input--active' : ''"
          id="type-select"
        >
          <option *ngFor="let type of lineTypes" [ngValue]="type">{{ type }}</option>
        </select>
        <label for="type-select">Line type</label>
      </div>
      <div class="line-creator__button-group">
        <button type="button" class="button-primary" (click)="onClear()">CLEAR</button>
        <button type="submit" class="button-primary">SAVE</button>
      </div>
    </form>
  </div>
  <div class="grid-main">
    <section class="line-creator__waypoints">
      <header class="line-creator__waypoints-header">
        <h3>Line waypoints</h3>
        <span>{{ line.length }} points</span>
      </header>

      <div class="line-creator__waypoints-empty" *ngIf="line.length === 0">
        Click on the map to add waypoints.
      </div>

      <div
        class="line-creator__waypoint"
        *ngFor="let location of line; let i = index"
        [ngClass]="{ 'line-creator__waypoint--mismatch': hasElevationMismatch(location) }"
      >
        <div class="line-creator__waypoint-top">
          <span class="line-creator__waypoint-index">#{{ i + 1 }}</span>
          <strong>{{ formatDistance(location.distanceFromStart) }}</strong>
        </div>
        <div class="line-creator__waypoint-coords">
          {{ location.latitude | number : '1.5-5' }}, {{ location.longitude | number : '1.5-5' }}
        </div>
        <div class="line-creator__waypoint-elevations">
          <span>Map: {{ formatElevation(location.elevation) }}</span>
          <span>API: {{ formatApiElevation(location) }}</span>
        </div>
        <div class="line-creator__waypoint-warning" *ngIf="hasElevationMismatch(location)">
          Elevation mismatch: {{ getElevationDiff(location) | number : '1.0-1' }} m
          (threshold: {{ elevationMismatchThresholdMeters }} m)
        </div>
      </div>
    </section>
  </div>
</div>
