<form class="line-creator" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
  <div class="line-creator__map-layout">
    <div class="line-creator__map-wrap">
      <gmp-map-3d *ngIf="apiReady" #map3dRef class="line-creator__map"></gmp-map-3d>
      <p *ngIf="mapUnavailable" class="line-creator__map-unavailable">3D map is unavailable right now.</p>
    </div>

    <aside class="line-creator__control-panel">
      <div class="line-creator__control-field">
        <label for="inputName">Name</label>
        <input type="text" class="input input--active" id="inputName" formControlName="lineName" required />
      </div>

      <div class="line-creator__control-field">
        <label for="sport-select">Sport</label>
        <select [formControl]="registerForm.controls.lineSport" class="input input--active" id="sport-select">
          <option *ngFor="let type of sportsTypes" [ngValue]="type">{{ type }}</option>
        </select>
      </div>

      <div class="line-creator__segment-selector">
        <label>Segment</label>
        <div class="line-creator__segment-buttons">
          <button
            type="button"
            class="line-creator__segment-button"
            *ngFor="let segmentType of segmentTypeOptions"
            [class.line-creator__segment-button--active]="activeSegmentType === segmentType.value"
            [style.borderColor]="getSegmentColor(segmentType.value)"
            [style.color]="activeSegmentType === segmentType.value ? '#fff' : getSegmentColor(segmentType.value)"
            [style.backgroundColor]="
              activeSegmentType === segmentType.value ? getSegmentColor(segmentType.value) : '#fff'
            "
            (click)="onSegmentTypeChange(segmentType.value)"
          >
            {{ segmentType.label }}
          </button>
        </div>
        <p class="line-creator__segment-hint">Switch segment before placing the next point.</p>
      </div>

      <div class="line-creator__segment-summary" *ngIf="segments.length > 0">
        <strong>{{ segments.length }} segments</strong>
        <span> / {{ line.length }} points</span>
      </div>

      <div class="line-creator__segment-summary line-creator__segment-summary--list" *ngIf="segments.length > 0">
        <span *ngFor="let segment of segments; let isLast = last">
          <strong [style.color]="getSegmentColor(segment.type)">{{ getSegmentLabel(segment.type) }}</strong>
          ({{ segment.locations.length }} pts){{ isLast ? '' : ', ' }}
        </span>
      </div>

      <div class="line-creator__button-group">
        <button type="button" class="button-primary" (click)="onUndoLastPoint()">UNDO</button>
        <button type="button" class="button-primary" (click)="onClear()">CLEAR</button>
        <button type="submit" class="button-primary">SAVE</button>
      </div>
    </aside>
  </div>

  <section class="line-creator__waypoints width-container">
    <header class="line-creator__waypoints-header">
      <h3>Line waypoints</h3>
      <span>{{ line.length }} points</span>
    </header>

    <div class="line-creator__waypoints-empty" *ngIf="line.length === 0">Click on the map to add waypoints.</div>

    <div
      class="line-creator__waypoint"
      *ngFor="let location of line; let i = index"
      [ngClass]="{ 'line-creator__waypoint--mismatch': hasElevationMismatch(location) }"
    >
      <div class="line-creator__waypoint-top">
        <span class="line-creator__waypoint-index">#{{ i + 1 }}</span>
        <strong>{{ formatDistance(location.distanceFromStart) }}</strong>
      </div>
      <div class="line-creator__waypoint-coords">
        {{ location.latitude | number : '1.5-5' }}, {{ location.longitude | number : '1.5-5' }}
      </div>
      <div class="line-creator__waypoint-elevations">
        <span>Map: {{ formatElevation(location.elevation) }}</span>
        <span>API: {{ formatApiElevation(location) }}</span>
      </div>
      <div class="line-creator__waypoint-warning" *ngIf="hasElevationMismatch(location)">
        Elevation mismatch: {{ getElevationDiff(location) | number : '1.0-1' }} m (threshold:
        {{ elevationMismatchThresholdMeters }} m)
      </div>
    </div>
  </section>
</form>
